using Microsoft.Extensions.AI;
using Microsoft.Extensions.VectorData;
using Microsoft.SemanticKernel.Connectors.InMemory;

var movieData = new List<Movie>()
{
    new Movie
        {
            Key=0,
            Title="狮子王",
            Description=@"《狮子王》是一部经典的迪士尼动画电影，讲述了一只名叫辛巴的小狮子在其父亲不幸去世后，踏上征程，夺回自己作为荣耀大地之王的王位的故事。
《狮子王》是一部由迪士尼在1994年制作的经典动画电影，讲述了一只名叫辛巴的幼狮从幼年到成年的成长历程，经历自我发现、责任和复仇的故事。这部电影通过非洲大草原上的动物们的故事展现了生命的循环主题，感人至深，并融合了亲情、友情、爱情和勇气等元素。
故事从一片广袤的非洲草原开始，辛巴的父亲，狮子王木法沙，是这片土地的统治者，受到动物们的尊敬。辛巴出生后，木法沙将儿子辛巴介绍给动物王国中的臣民，象征着新王朝的开始。辛巴的出生意味着他是未来的狮王，也将继承木法沙的职责和土地。这一神圣的仪式展现了""生命的循环""（Circle of Life），电影的主题曲也在此时响起，呈现出生命的庄严与和谐。
然而，辛巴的叔叔刀疤并不甘心屈居人下。他嫉妒辛巴的地位，因为辛巴的出生使得刀疤失去了成为狮王的机会。于是，刀疤开始密谋，企图通过卑劣的手段来篡夺王位。他先是利用辛巴的天真，怂恿辛巴去危险的象骨谷探险，并暗中安排鬣狗攻击辛巴，幸得木法沙及时赶到救下辛巴。然而，这次救援行动最终导致了木法沙的死。刀疤趁此机会将辛巴灌输罪恶感，让辛巴误以为自己是害死父亲的罪魁祸首，并劝辛巴逃离家园。无助的辛巴在痛苦和自责中逃往遥远的荒野。
辛巴逃亡后，刀疤成功夺取王位，与鬣狗一起掌控了动物王国。然而，刀疤的统治带来了极大的破坏，王国变得荒凉和贫瘠，食物匮乏，生命的循环失去了平衡。与此同时，辛巴在逃亡途中遇到了狐獴丁满和疣猪彭彭这两个性格乐天的朋友。他们教会了辛巴一种无忧无虑的生活方式——“哈库那·玛塔塔”（Hakuna Matata），即“没有烦恼”的生活哲学。在他们的陪伴下，辛巴渐渐从失去父亲的痛苦中走出来，过上了逍遥自在的日子，并逐渐成长为一只强壮的雄狮。然而，他始终没有忘记故乡，也没有完全摆脱对父亲的思念和对自己“罪行”的愧疚。
多年后，辛巴的童年玩伴娜娜在寻找食物时偶然发现了他。娜娜告诉辛巴，刀疤的暴政让动物王国的状况每况愈下，鼓励辛巴回去复仇，承担起他作为狮子王的责任。辛巴起初因为内疚和恐惧而拒绝，认为自己无法面对父亲的死。但在遇到拉飞奇——王国的巫师猩猩之后，辛巴经历了一次内心的觉醒。拉飞奇帮助辛巴理解父亲的精神依然活在他的心中，并引导他见到了父亲木法沙的灵魂。木法沙告诉辛巴，他需要承担起自己的责任，恢复王国的和平和秩序。这次深刻的对话让辛巴重新燃起了对自己使命的信念。
辛巴终于决定返回家园，与刀疤展开决战。在这场斗争中，辛巴揭露了刀疤的罪行，最终夺回了属于自己的王位。刀疤在争斗中企图逃脱，但最终被他自己一手扶植的鬣狗反噬而死，象征着恶人自食其果。辛巴成功地拯救了动物王国，并在娜娜的陪伴下重新带领家园恢复和平与繁荣。
电影最后，辛巴成为了新一代的狮子王，整个草原在他的带领下重新充满了生机。在辛巴和娜娜的孩子出生时，动物们再次齐聚在荣耀石前，庆祝生命的延续。电影在这里回到了""生命的循环""这一主题，表达了新一代的开始和生生不息的生命传承。辛巴通过这段充满曲折的旅程，不仅找回了自己的勇气，还理解了家庭和责任的真正含义，最终成为了成熟、强大的狮子王。
《狮子王》不仅是一部精彩的冒险故事，还包含了对成长、责任、家庭和勇气的深刻探讨。辛巴的成长历程展现了一个从自我逃避到勇敢面对责任的转变过程，影片也传递出每个人都可以在困境中找到自己的力量。这部电影以其深刻的寓意和感人的情感触动了无数观众，不仅仅是儿童的动画片，更是全年龄观众都能从中得到启示的经典之作。
"
        },
    new Movie
        {
            Key=1,
            Title="盗梦空间",
            Description=@"《盗梦空间》是一部由克里斯托弗·诺兰执导的科幻电影，讲述了一群窃贼进入目标的梦境以窃取信息的故事。《盗梦空间》（Inception）是一部由克里斯托弗·诺兰执导的科幻悬疑电影，于2010年上映。这部电影以复杂的梦境世界和层层嵌套的梦中梦结构为特点，讲述了一群“盗梦者”通过潜入他人梦境来窃取或植入信息的惊险故事。影片的主题涉及潜意识、现实与梦境的边界、心理创伤以及自我救赎，成为电影史上极具创意和影响力的作品之一。
故事的主角多姆·柯布（由莱昂纳多·迪卡普里奥饰演）是一名技术高超的“盗梦师”，他擅长通过潜入他人梦境来窃取秘密。然而，这项技术是一种非法行为，使得柯布成为全球通缉的逃犯，并因此无法回到家人身边。柯布的团队中还包括阿瑟（约瑟夫·高登-莱维特饰）、艾姆斯（汤姆·哈迪饰）、尤瑟夫（迪利普·拉奥饰）等人，他们各自拥有特殊技能，在梦境行动中发挥不同作用。
故事的核心任务是一项名为“植梦”的任务，这次任务的委托人是日本企业家斋藤（渡边谦饰）。他希望柯布团队向竞争对手费舍尔（希里安·墨菲饰）的大脑中植入一个念头，让费舍尔放弃父亲的公司，最终使得斋藤在商业竞争中获胜。为了换取柯布的清白身份和回家资格，斋藤承诺利用自己的权力帮柯布解决他的法律问题。
然而，“植梦”比盗取梦境更加困难，因为这种技术需要在被植入者的潜意识深处埋下一个“原始的想法”，使其相信这个想法是自己本身的意愿。为了完成这项任务，柯布团队决定进行多层梦境嵌套，即通过梦中梦的方式，逐渐深入到费舍尔的潜意识深处。每一层梦境都需要一个独立的创造者和策划者，因此团队中加入了一位新成员——梦境建筑师阿丽雅德妮（艾伦·佩吉饰）。阿丽雅德妮负责设计每层梦境的结构，以确保在执行任务时，梦境能够稳定且不易崩塌。
在执行任务的过程中，柯布的心理创伤逐渐显现。他的妻子玛尔（玛丽昂·歌迪亚饰）曾经和他一起沉迷于梦境，最终无法区分现实与梦境，选择了自杀。然而，她在梦境中的影像却始终困扰着柯布，并在任务中不断出现，干扰了任务的顺利进行。这一切源于柯布内心深处的愧疚，他认为自己才是导致妻子死亡的罪魁祸首。
随着任务的深入，费舍尔的潜意识防御机制也越来越强烈，梦境中的场景开始充满各种危险。为了成功完成任务，柯布和团队成员不得不在紧张的时间限制内，一层层地深入梦境，每一层的时间流速都会相应地减缓。影片中的时间概念设定独特：现实中几分钟的时间，在第一层梦境中可能是一小时，而到了更深的梦境层次，时间流逝则更为缓慢，甚至达到数十年。团队每前进一步，都要面对潜意识的反击以及梦境崩塌的危险。
在梦境的最深层——“迷失域”（limbo）中，柯布不得不与自己的过去和潜意识进行最后的对抗。他终于放下了对妻子的愧疚，意识到她只是自己潜意识中的影像，而非真实的她。在费舍尔方面，柯布团队成功植入了让费舍尔解散公司、走向独立的想法，任务宣告成功。斋藤也履行了承诺，为柯布清除了通缉记录，柯布得以回到家乡，终于见到自己思念已久的孩子们。
影片的最后一幕成为全片最具争议和讨论的话题。柯布回到家中，拿出了一个小陀螺，这是他用来区分现实与梦境的“图腾”。在影片结尾，陀螺一直在旋转，而镜头却在陀螺停顿之前迅速切断，留下一个开放式的结局——观众无法得知柯布此时究竟处于现实还是梦境中。这个模棱两可的结局成为影片的经典之处，引发了观众对现实与梦境关系的思考。
《盗梦空间》通过复杂的叙事结构、多层次的梦境世界和极具哲理的主题，探讨了现实和梦境的界限、个体潜意识的力量以及记忆和自我认知的问题。影片的情节设置极为精巧，每一层梦境都有其独特的规则和视觉效果，配合汉斯·季默的震撼配乐，营造出一种紧张且充满悬疑的氛围。这部电影不仅是视觉和听觉上的享受，更是对心理学和哲学层面的深刻探索，被认为是诺兰的巅峰之作之一。"
        },
    new Movie
        {
            Key=2,
            Title="黑客帝国",
            Description=@"《黑客帝国》是一部由沃卓斯基姐妹执导的科幻电影，讲述了一名叫尼奥的电脑黑客发现自己所处的世界其实是由机器制造的虚拟现实的故事。
《黑客帝国》（The Matrix）是一部1999年由沃卓斯基姐妹（原为沃卓斯基兄弟）执导的科幻动作电影，它探索了现实与虚拟之间的界限，通过惊人的视觉特效和深刻的哲学思想震撼了观众。影片讲述了主角尼奥（基努·里维斯饰）发现自己所处的世界是一个计算机生成的虚拟现实，并在觉醒后加入人类反抗机器统治的斗争。
故事背景:影片设定在一个未来的反乌托邦世界中，地球已被智能机器掌控。人类与机器之间爆发过大战，最终机器胜利，为了获得能量，机器将人类圈养起来，并将他们的大脑连接到一个虚拟世界——“矩阵”（The Matrix）中。矩阵是机器用来控制和麻痹人类的虚拟现实系统，人们在其中过着“正常”的生活，但他们并不知道自己实际上被困在一个虚拟监狱中。
主线剧情:故事的主人公托马斯·安德森（网名“尼奥”）是一名程序员，白天在公司工作，夜晚则是技术高超的黑客。尼奥一直感觉到周围的世界不真实，并通过黑客手段不断寻找“矩阵”的真相。某天，他接到了神秘黑客崔妮蒂（凯莉·安·摩斯饰）的邀请，告诉他可以揭示真实世界的秘密。
尼奥最终见到了莫菲斯（劳伦斯·菲什伯恩饰），一个神秘的领袖，告诉尼奥他所在的世界并不是真实的，而是“矩阵”——一个由机器创造的虚拟世界，用来压制人类的意识。莫菲斯认为尼奥是“救世主”，他将能够带领人类从矩阵中解放出来。莫菲斯给尼奥提供了两个选择：吃下蓝色药丸，继续留在虚拟的假象世界中；或者吃下红色药丸，进入现实，揭开真相。尼奥选择了红色药丸，接着经历了极其痛苦的觉醒过程，脱离了机器的控制，来到了真正的现实世界。
现实世界和反抗军:尼奥在现实世界醒来后，发现自己身处于一个机器控制的废土地球。人类反抗组织住在“锡安”——地球上最后的人类城市，他们通过黑客手段入侵矩阵系统，并通过心灵和技术的结合对抗机器。尼奥加入了莫菲斯的团队，并学习如何在矩阵中超越常人极限，理解矩阵的规则和漏洞。他们发现，在矩阵中，一切都是代码，所以他们可以学习各种技能，甚至超越物理法则，实现超人般的能力。
然而，矩阵中也有程序被设计成防御系统，用来猎杀反抗分子。这些程序的化身是“特工”，其中最著名的就是特工史密斯（雨果·维文饰）。特工史密斯冷酷无情，具备极高的战斗能力，他的任务是阻止人类逃离矩阵和摧毁反抗军。
尼奥的觉醒与拯救:在不断训练和与特工战斗的过程中，尼奥逐渐展现出非凡的能力，但他对自己的身份仍然心存疑惑。他怀疑自己是否真的是“救世主”，但莫菲斯和崔妮蒂坚信尼奥会在关键时刻觉醒，解放人类。
在最终的高潮对决中，尼奥面对特工史密斯，并在战斗中觉醒了他作为“救世主”的潜能。他不仅能在矩阵中飞行，随意改变虚拟世界的规则，还可以轻松击败特工。尼奥最终掌握了矩阵的核心奥义，变得几乎无所不能。他向机器和矩阵发出威胁，表示人类将要觉醒，走向自由。影片在尼奥飞向空中，宣布革命的决心中结束，为续集埋下伏笔。
影片主题:《黑客帝国》结合了多种哲学思想，特别是柏拉图的“洞穴寓言”和笛卡尔的“我思故我在”，探讨了现实与虚拟、自由与控制之间的关系。影片的主题引人深思，令人怀疑人类所认知的现实是否真的存在，或者是否可能是某种高层存在所创造的虚拟世界。
1. **现实与虚拟的界限**：影片引导观众思考现实的本质。如果现实仅仅是我们的意识所感知的结果，那么是否存在一种更高层次的现实？影片中的矩阵象征着现代社会的束缚与控制，人们被“设定”在固定的生活模式中，失去了真正的自由。
2. **自由意志**：影片提到了“命运”与“选择”之间的对立。尼奥在矩阵中有无穷的可能性，但真正的力量来自他在关键时刻的选择。他选择红色药丸，选择对抗特工，选择觉醒，这些决定使他走上了救世主之路。
3. **救世主的隐喻**：尼奥作为救世主，象征着一个“人类希望的化身”，引入了基督教的元素。他最终通过自我牺牲与重生实现了自我超越和解放人类的使命。
4. **控制与反抗**：影片中的机器象征了高度发达但缺乏人性的科技控制体系，而人类反抗军则代表自由和灵魂的抗争。影片中反复强调觉醒的重要性，鼓励人们突破自身的束缚，挣脱外界的控制，去追寻属于自己的真理。
视觉特效和影响力:《黑客帝国》不仅以其深刻的哲学主题著称，还以其开创性的视觉特效震撼全球。影片中使用的“子弹时间”效果，能够捕捉人物躲避子弹的慢动作，被认为是电影特效史上的一大突破。影片对虚拟现实、人工智能和数字时代的思考，前瞻性地预见了未来科技可能对人类生活产生的影响。
《黑客帝国》开创了一种全新的视觉风格和叙事模式，引发了大众对现实与虚拟世界的思考，同时也深刻影响了后来的科幻电影、电子游戏和流行文化。它不仅是一部娱乐性的动作大片，更是一部充满哲学内涵的作品，在全球范围内拥有大量影迷和深远的影响力。"
        },
    new Movie
        {
            Key=3,
            Title="怪物史瑞克",
            Description=@"《怪物史瑞克》是一部动画电影，讲述了一只名叫史瑞克的食人魔踏上征程，去解救被龙困住的菲奥娜公主，并将她带回杜洛克王国的故事。
《怪物史瑞克》（Shrek）是一部由梦工厂于2001年出品的动画电影，讲述了一个绿色食人魔史瑞克的幽默冒险故事。电影颠覆了传统的童话故事，将英雄设定为一个外表粗犷、性格古怪的食人魔，通过有趣的情节和出人意料的角色设定，展现了友情、爱情、自我接受和反偏见的主题。
故事梗概:故事发生在一个童话世界里，主角史瑞克是一只绿色的食人魔，他生活在森林中的一个偏僻沼泽地。他性格孤僻，享受着无人打扰的生活。然而，和平的日子被打破了，邪恶的小个子领主法奎德把大量童话角色（如白雪公主、皮诺曹、小红帽等）驱逐到了史瑞克的沼泽中，以净化他的王国“杜洛克”。这些童话角色打扰了史瑞克的生活，让他非常恼火。
为了解决这个问题，史瑞克决定前往杜洛克，找到法奎德领主，要求他恢复自己的清静生活。在旅程中，史瑞克意外地结识了一只话痨的驴子——“驴哥”，虽然驴哥一开始让他不胜其烦，但后来成为了史瑞克最忠诚的朋友和旅伴。两人一同前往法奎德的城堡。
法奎德领主想要娶一位公主，以获得“国王”的合法身份，但由于他无法亲自去解救公主，便提出条件让史瑞克帮助他从高塔中营救被囚禁的菲奥娜公主。作为回报，法奎德承诺在任务完成后将沼泽归还给史瑞克。于是，史瑞克和驴哥踏上了拯救公主的冒险旅程。
菲奥娜公主的秘密:在营救菲奥娜公主的过程中，史瑞克和驴哥经历了种种搞笑的危机，包括面对一条火红的母龙。在成功营救了菲奥娜后，三人一同踏上回杜洛克的路上。一路上，史瑞克和菲奥娜逐渐相互了解，菲奥娜的个性与典型的公主形象截然不同——她不但身手矫健，还拥有怪物般的食量和生活习惯。两人开始产生好感，史瑞克逐渐对这位外表美丽、内心却充满怪癖的公主产生了情感。
在旅途中，驴哥偶然发现了菲奥娜的秘密：菲奥娜每当夜晚降临，便会变成一只与史瑞克类似的绿色怪物。原来，她被施了魔法，只有在找到她的真爱并得到真爱之吻后才能破除魔咒。菲奥娜非常害怕别人发现这个秘密，尤其担心史瑞克会因此而疏远她。她害怕自己的怪物形态，认为只有变回“正常”的美丽公主才能得到真正的幸福。
误解与决斗:就在史瑞克和菲奥娜两人感情逐渐升温之时，误会发生了。史瑞克误解菲奥娜不喜欢他，因为他认为自己丑陋、没有资格得到公主的爱。于是他愤然离开，回到了法奎德领主处，并将菲奥娜交给了法奎德。然而，在回去的路上，驴哥说服了他去面对自己的感情，让他意识到自己的自卑与偏见阻碍了他追求幸福的机会。
最终，史瑞克勇敢地返回杜洛克，打断了菲奥娜与法奎德的婚礼。在最后的关键时刻，菲奥娜承认了自己对史瑞克的爱，两人终于在众人面前亲吻，这一吻打破了菲奥娜的诅咒，但结果出人意料：菲奥娜并未变回人类公主，而是永远变成了与史瑞克相似的绿色怪物。这一意外却让两人更加幸福，因为他们接受了彼此的真实模样，爱上了对方不完美的样子。
故事的最后，法奎德被母龙吞噬，史瑞克和菲奥娜回到沼泽中，在童话角色的祝福下开始了他们的新生活。
主题与寓意
《怪物史瑞克》虽然是童话故事，但它的主题直指偏见、接受与真爱。影片通过逆转传统的“英雄与公主”设定，打破了观众对“美”与“丑”、“怪物”与“人类”的传统印象。史瑞克和菲奥娜都是不完美的角色，他们最终因为接受彼此的缺陷、爱上真实的对方而获得幸福。
1. **外貌与内在**：影片挑战了“外貌即一切”的观念。史瑞克外表丑陋却拥有善良的内心，而菲奥娜也在接纳自己内在的过程中找到了幸福。影片讽刺了那些只看外貌、忽视内心的人物设定，例如法奎德，他虽然追求外在的完美和权力，但内心却卑鄙、虚伪。
2. **自我接纳**：史瑞克和菲奥娜在过程中学会了接纳自己，尤其是菲奥娜，她意识到美不仅在外表，而在内心。两人最终都放下了对自我的偏见，接受了真实的彼此。
3. **颠覆传统童话**：影片对传统童话进行了颠覆，角色的性格设定和情节反转给观众带来了耳目一新的感受。它告诉我们，真爱并不总是“王子与公主”的模式，幸福也不是建立在完美和外在之上。
4. **友情与支持**：驴哥虽然性格絮絮叨叨，但他对史瑞克的陪伴和鼓励起到了重要的作用。他不断支持史瑞克，让他明白友谊和爱情的意义，驴哥代表了那种即使表面上看似烦人，但在关键时刻不离不弃的朋友形象。
影片的影响与评价
《怪物史瑞克》上映后获得了极大的成功，凭借其幽默的对白、创新的角色设定和引人深思的主题，吸引了全球观众。这部影片不仅适合儿童观看，也深受成人喜爱，因为其中的幽默、讽刺和深刻的主题让不同年龄层的观众都能从中获得启发。影片还赢得了第74届奥斯卡的最佳动画长片奖，是第一部获得该奖项的影片。
《怪物史瑞克》之后推出了多部续集和衍生作品，继续讲述史瑞克、菲奥娜、驴哥等角色的冒险故事，进一步拓展了这个童话世界。影片不仅仅是一部充满笑点的动画，更是一部探讨接受与自爱的经典之作。"
        }
};
#pragma warning disable SKEXP0020
#pragma warning disable SKEXP0070
var vectorStore = new InMemoryVectorStore();
var movies = vectorStore.GetCollection<int, Movie>("movies");
await movies.CreateCollectionIfNotExistsAsync();
var key = File.ReadAllText("c://GPT/key.txt");
IEmbeddingGenerator<string, Embedding<float>> generator =
 new OpenAIEmbeddingGenerator(new OpenAI.OpenAIClient(key), "text-embedding-3-small");

foreach (var movie in movieData)
{
    movie.Vector = await generator.GenerateEmbeddingVectorAsync(movie.Description);
    await movies.UpsertAsync(movie);
}

while (true)
{
    Console.WriteLine("请输入查询：");
    var query = Console.ReadLine();
    var queryEmbedding = await generator.GenerateEmbeddingVectorAsync(query);

    var searchOptions = new VectorSearchOptions()
    {
        Top = 4,
        VectorPropertyName = "Vector"
    };

    var results = await movies.VectorizedSearchAsync(queryEmbedding, searchOptions);

    await foreach (var result in results.Results)
    {
        Console.WriteLine($"Title: {result.Record.Title}");
        Console.WriteLine($"Description: {result.Record.Description}");
        Console.WriteLine($"Score: {result.Score}");
        Console.WriteLine();
    }

}




public class Movie
{
    [VectorStoreRecordKey]
    public int Key { get; set; }

    [VectorStoreRecordData]
    public string Title { get; set; }

    [VectorStoreRecordData]
    public string Description { get; set; }

    [VectorStoreRecordVector(1536, DistanceFunction.CosineSimilarity)]
    public ReadOnlyMemory<float> Vector { get; set; }
}