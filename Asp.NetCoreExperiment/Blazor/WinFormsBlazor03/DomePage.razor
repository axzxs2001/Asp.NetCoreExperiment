@using Microsoft.AspNetCore.Components.Web
@inject Button but
@inject System.Windows.Forms.Timer timer
@using Microsoft.JSInterop;
@inject IJSRuntime js

<div>
    <h2 id="title">折线图</h2>
</div>
<canvas id="myChart" width="400" height="200"></canvas>
@code {
    List<int> data = new List<int>();
    List<int> labels = new List<int>();
    int key = 2000;
    protected override void OnInitialized()
    {
        base.OnInitialized();
        but.Click += async (s, e) =>
        {
            await js.InvokeAsync<object>("createChart");
            timer.Enabled = true;
        };

        timer.Tick += async (s, e) =>
        {
            var random = new Random();
            data.Add(random.Next(10, 100));
            labels.Add(key);
            key++;
            var newData = data.Count > 20 ? data.ToArray()[^20..] : data.ToArray();
            var newLabels = labels.Count > 20 ? labels.ToArray()[^20..] : labels.ToArray();
            data = new List<int>(newData);
            labels = new List<int>(newLabels);
            await CallJS(newData, newLabels);
        };

        async Task CallJS(int[] data, int[] labels)
        {
            await js.InvokeAsync<object>("showLines", data, labels);
        }

    }
}